### - 2025-07-10

### ✨ 新功能
- 新增 `build_prompt()`：把 prompt 結構獨立拆出來，方便後續改 prompt 不用動主邏輯
- 加上 `clean_markdown()`：自動清掉 LLM 回傳的 markdown 標記，讓前端不會亂跑格式
- 模型回傳格式改成純文字 + emoji + 分段，更適合 SME 顧問聊天的口吻

### 🛠 調整優化
- 重構 `query_llm()`：把 prompt 組裝、清理、回傳流程都拆清楚
- LLM 回應不再夾雜太多 metadata，只回前端需要的部分（source file 改成 log-only）
- 相似度調整為 `top_k=3`，讓產品推薦更精準

### 🧪 前端建議配合
- CSS 請加上 `.ai-message { white-space: pre-wrap; word-break: break-word; }`，確保段落有正常換行，不會整段擠成一行

### 🧠 更新背景
改動主要是為了讓 AI 回應「更好讀、更貼近 SME 對話風格」，也順便鋪路未來要接記憶功能、多輪引導邏輯，前後端都會比較好整合。

##########################################################################################################################################
